
<MyScreenManager>:
    MainScreen:
    
<MainScreen>:
    name:'GUI'
    runtype:"File"
    BoxLayout:
        orientation:'vertical'
        BoxLayout:
            BoxLayout:
                orientation:'horizontal'
                spacing:-1
                size_hint:(0.25,1)
                Label:
                    text:"DeepMeerkat V0.0.1"
                    font_size:13
                Button:
                    text:"Help"
                    on_press: root.help_site()   
                Button:
                    text:"Advanced settings"
                    on_press: root.gotoAdvanced(app.root)
        BoxLayout:
            Label:
                text:"Run Type"
            ToggleButton:
                text: "File"
                group:"method"
                state:'down'
                on_press:app.root.MM.args.runtype='File'
            ToggleButton:
                text:"Folder"
                group:"method"
                on_press:app.root.MM.args.runtype='Folder'
        Button:
            text:"Choose input"
            on_press:root.gotoFileOpen(app.root)
        Button:
            text:"Choose output directory"
            on_press:root.gotoOutdir(app.root)
        Label:
            text: "[b]Input:[/b] " + str(root.)
            markup: True
            font_size:20
        Label:
            text: "[b]Output:[/b] " + str(root)
            markup: True
            font_size:20
        Button: 
            text:"Run"
            font_size:40
            size_hint:(1,0.6)
            on_release:root.run_press(app.root)
<FileOpen>:
    name:"FileOpen"
    text_input: text_input
    BoxLayout:
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''
        Label:
            text: "Select or type path below"
        TextInput:
            text_input: text_input
            id: text_input
            height: 40
            multiline: False
    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
            on_release: root.gotoMain(app.root)
        Button:
            text: "Select"
            on_release: app.root.MM.args.input=text_input.text; root.gotoMain(app.root)
<Outdir>:
    name:"Outdir"
    text_input: text_input
    BoxLayout:
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''
        TextInput:
            text_input: text_input
            id: text_input
            size_hint_y: None
            height: 40
            multiline: False
    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
            on_release: root.gotoMain(app.root)
        Button:
            text: "Save"
            on_release: app.root.MM.args.output=filechooser.path; root.gotoMain(app.root)
            
<AdvancedScreen>
    on_enter:app.root.MM.mode='advanced'
    BoxLayout:
        orientation:'vertical'
        Button:
            text: "Back"
            size_hint:(0.2,.3)
            pos_hint:{'top':0}
            on_press:root.gotoMain(app.root)
        BoxLayout:
            Label:
                text: "Draw Motion Objects"
            CheckBox:
                active: False
                on_active:app.root.MM.todraw=self.active
        BoxLayout:
            Label:
                text: "Multithreaded"
            CheckBox:
                active: True
                on_active:app.root.MM.args.threaded=self.active
        Label:
            text:"Path to tensorflow model"
        TextInput:
            text:str(app.root.MM.args.path_to_model)
            on_text: app.root.MM.args.path_to_model=self.text
            font_size:20
            multiline:False
        Button:
            text:"Run"
            font_size:40
            size_hint:(1,0.6)
            on_release:root.run_press(app.root)

<ProgressScreen>
    id: P
    on_pre_enter:root.assignname(app.root.MM)
    on_enter: root.MotionM(app.root.MM)
    on_waitflag: if self.waitflag==1: root.gotoresults(app.root)
    on_errorflag: if self.errorflag==1: root.gotoErrorScreen(app.root)

    BoxLayout:
        orientation:'vertical'
        BoxLayout:
            size_hint:(1,1)
            pos_hint:{'center_y':1}
            orientation:'vertical'
            Label:
                text: "[b]TensorFlow Status:[/b] "
                markup: True
                font_size:20
            Label:
                text: "[b]Running File:[/b] " + str(app.root.MM.args.input)
                markup: True
                font_size:20
            Label:
                text: "[b]Output Directory:[/b] " + str(app.root.MM.args.output)
                markup: True
                font_size:20
        BoxLayout:
            size_hint:(0.9,1)
            
            Label:
                text: 'Progress'
                size_hint:(0.25,1)
                font_size:20
            ProgressBar:
                id:pb
                value: 0
                size_hint:(0.8,1)
                                          
<ResultsScreen>
    BoxLayout:
        orientation:'vertical'
        Button:
            text: "Restart"
            size_hint:(0.2,.3)
            pos_hint:{'top':0}
            on_press:root.gotoMain(app.root)
        Label:
            text: "[b]Input File:[/b] " + str(app.root.MM.args.input)
            markup: True
            font_size:20
        Label:
            text: "[b]Output Directory:[/b] " + str(app.root.MM.args.output)
            markup: True
            font_size:20
        #Label:
            #text: "[b]Run time:[/b] " + str(round(app.root.MM.total_min,2)) + " min"
            #markup: True
            #font_size:20
        #Label:
            #text:str(len(app.root.MM.annotations)) + " candidate motion frames " + "from " + str(app.root.MM.frame_count) + " images (" + str(round(float(len(app.root.MM.annotations))/app.root.MM.frame_count,3)*100) + "%)"
            #font_size:20
        Button:
            text: "More statistics and parameter information"
            size_hint:(1,0.5)
            on_press: root.openfile(app.root.MM)   

<ErrorScreen>
    on_enter:root.getMessage(app.root)
    BoxLayout:
        orientation:'vertical'
        Button:
            text:"Restart"
            on_press:root.gotoMain(app.root)
            size_hint:(0.25,0.4)
        Label:
            text: "Error occurred!"
            font_size:20
        TextInput:
            id:"emessage'
            text: root.em
            size_hint:(1,2)
        Button:
            text: "Parameter Log"
            size_hint:(1,0.5)
            on_press: root.openfile(app.root.MM)           
        Label:
            text: "If you believe this is a bug, submit the parameter log,\na copy of your error, and a description of your video to the link below."            
        Button:
            text: "Send Error Report"
            on_press: root.help_issue()
            size_hint:(1,0.5)

    